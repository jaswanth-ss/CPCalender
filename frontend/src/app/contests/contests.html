<div class="page contests-page">
  <header class="page-header">
    <h1 class="page-title">Contests</h1>
    <p class="page-subtitle">Search by platform and date range</p>
  </header>

  <section class="filter-section">
    <form (ngSubmit)="onSearch()" class="filter-form">
      <div class="filter-group platformSearch" (blur)="dropDown = false">
        <label for="platform">Platform</label>
        <input type="text" id="platform" name="platform" [(ngModel)]="searchInput" (input)="onInput()" (focus)="dropDown = true" autocomplete="off" placeholder="Type to filter…">
        @if (dropDown) {
          <div class="filter-dropdown">
            @for (platform of filteredPlatforms; track $index) {
              <button type="button" class="filter-option" [class.selected]="selectedPlatform(platform)" (click)="selectOption(platform)">{{ platform }}</button>
            }
          </div>
        }
      </div>
      <div class="filter-group filter-dates">
        <label for="startDate">Start date</label>
        <input type="date" id="startDate" name="startDate" [(ngModel)]="startDate">
      </div>
      <div class="filter-group filter-dates">
        <label for="endDate">End date</label>
        <input type="date" id="endDate" name="endDate" [(ngModel)]="endDate" [disabled]="startDate === ''" [min]="startDate">
      </div>
      <div class="filter-submit">
        <button type="submit" class="btn btn-primary search-btn">Search</button>
      </div>
    </form>
  </section>

  <section class="results-section">
    @if (contests().length > 0) {
      <div class="results-wrap">
        <table class="contests-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Contest</th>
              <th>Platform</th>
              <th>Start</th>
              <th>Duration</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            @for (contest of contests(); track contest.id; let i = $index) {
              <tr>
                <td class="sno">{{ i + 1 }}</td>
                <td class="contest-name"><a [href]="contest.href" target="_blank">{{ contest.event }}</a></td>
                <td class="contest-platform">{{ contest.resource.name.split('.')[0] }}</td>
                <td class="contest-time">{{ contest.start }}</td>
                <td class="contest-duration">{{ contest.duration / 60 }} min</td>
                <td><button type="button" class="add-calendar">Add to calendar</button></td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    } @else if (isLoading()) {
      <div class="state-box state-empty">
        <p class="state-message">Loading contests…</p>
      </div>
    } @else {
      <div class="state-box state-empty">
        <p class="state-message">Search by platform and date range to see contests.</p>
      </div>
    }
  </section>
</div>
